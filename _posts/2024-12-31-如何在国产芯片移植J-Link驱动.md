---
layout:     post
title:      如何在国产芯片移植J-Link驱动
subtitle:   基于J-Link实现国产单片机烧录的完整教程
date:       2024-12-31
author:     嵌入式电子知识记录
header-img: img/post-bg-debug.png
catalog:    true
tags:
    - 嵌入式
    - J-Link
    - 国产芯片
    - 教程
---

## 前言

最近在开发一些国产的单片机，项目量产的时候，这些厂家老喜欢推荐他们的脱机烧录器，而且他们的脱机烧录器还价格不菲，便宜的几百块钱，贵的要好几千。

正好之前用过Nordic的芯片，我看他们家的芯片量产可以直接兼容J-Link，利用脚本就可以下载了。受到启发我也弄了一个基于J-Link的烧录脚本。

## 准备的工具

### 软件
- **JLink** - 可以到SEGGER官网上下载

### 硬件  
- **J-Link仿真器** - 淘宝上几十到几百块的比较多

J-Link下载完成后直接一路点击next安装即可，安装路径也使用默认的。

## 操作步骤

### 1. 查找Flash下载算法

首先需要找到Flash下载算法，这个一般芯片供应商会提供一个pack包。

如果是基于Keil开发环境的，芯片厂商通常会给一个 `.pack` 文件（例如 `Vango.V85XX.4.0.2.pack`）。

你只需要直接双击然后一直点next，它会解压出来一个 `.flm` 后缀的算法文件。安装路径需要记录下来。

### 2. 获取FLM文件

在刚才的安装路径下面找到这个 `.flm` 文件。

### 3. 使用FLM算法文件

将该文件拷贝到J-Link安装目录的 `Device` 文件夹下面。

> **建议**：在 `Device` 文件夹下面创建一个自定义名称的文件夹（例如 `vango`），并将flm文件放入其中。

然后找到 `C:\Program Files\SEGGER\JLink\JLinkDevices.xml` 文件并进行修改。

修改内容需要根据你的单片机内核选择对应的配置。具体的参数修改需要参考单片机的 **datasheet**，特别是内存映射部分。

### 4. 编写烧录脚本

需要准备两个脚本文件：

#### download.jlink

```
r
loadfile D:\path\to\your\project.hex
exit
```

#### testdownload.bat

```batch
jlink.exe -device v8530 -if SWD -speed 10000 -autoconnect 1 -CommandFile download.jlink
```

### 5. 运行与验证

直接在cmd中运行 `testdownload.bat`。

如果配置正确，会弹出SEGGER的下载进度条，显示下载成功。

## 常见问题

**Q: 提示找不到 JLink.exe？**

A: 请确保将 JLink 的安装目录添加到了系统的环境变量中。

---

*本文转载自微信公众号"嵌入式电子知识记录"*
